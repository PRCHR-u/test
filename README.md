# Django REST API для сети по продаже электроники

Этот проект представляет собой REST API для управления иерархической сетью поставщиков электроники. Приложение построено на Django с использованием Django REST Framework и работает в контейнерах Docker. В проекте реализовано разделение на `dev` (разработка) и `prod` (продакшен) окружения.

## Технологический стек

- **Backend:** Python 3.11, Django 3.2, Django REST Framework 3.13, Gunicorn
- **База данных:** PostgreSQL 13
- **Контейнеризация:** Docker, Docker Compose
- **Документация API:** drf-spectacular (Swagger/OpenAPI)

## Запуск проекта

Проект настроен для работы в двух окружениях: для разработки (`dev`) и для продакшена (`prod`). Миграции базы данных применяются автоматически при каждом запуске.

### 1. Подготовка

- **Склонируйте репозиторий:**
  ```bash
  git clone <URL вашего репозитория>
  cd <папка проекта>
  ```

- **Настройте файлы окружения:**
  В корне проекта есть примеры `.env.dev` и `.env.prod`. Вам **не нужно** создавать `.env` файл вручную. Docker Compose сам выберет нужный файл в зависимости от команды запуска. **Обязательно** просмотрите и измените `.env.prod` перед запуском в продакшене, особенно `SECRET_KEY` и `POSTGRES_PASSWORD`.

### 2. Запуск в режиме разработки (dev)

Эта команда использует файлы `docker-compose.yml` и `docker-compose.override.yml`, а также переменные из `.env.dev`.

```bash
# Собрать и запустить контейнеры в фоновом режиме
docker-compose up --build -d
```

- **Что происходит:**
    - Запускаются сервисы `web` и `db`.
    - Исходный код монтируется в контейнер `web`, что позволяет применять изменения "на лету".
    - `DEBUG` установлен в `True`.
    - Приложение запускается с помощью `manage.py runserver`.
    - Приложение доступно по адресу [http://localhost:8000](http://localhost:8000).
    - База данных доступна по порту `5432` на вашем хосте.

- **Чтобы остановить сервисы:**
  ```bash
  docker-compose down
  ```

### 3. Запуск в режиме продакшена (prod)

Эта команда **дополнительно** использует файл `docker-compose.prod.yml` и переменные из `.env.prod`.

```bash
# Собрать и запустить контейнеры, используя prod-конфигурацию
docker-compose -f docker-compose.yml -f docker-compose.prod.yml up --build -d
```

- **Что происходит:**
    - Исходный код **копируется** в образ. Изменения в коде потребуют пересборки образа.
    - `DEBUG` установлен в `False`.
    - Приложение запускается с помощью `gunicorn` для большей производительности и безопасности.
    - Приложение доступно по адресу [http://localhost:80](http://localhost:80) (стандартный HTTP порт).
    - Порт базы данных **не** доступен извне контейнерной сети.

- **Чтобы остановить сервисы:**
  ```bash
  docker-compose -f docker-compose.yml -f docker-compose.prod.yml down
  ```

## Первичная настройка и тестовые данные

После первого запуска контейнеров, вы можете наполнить базу данных тестовыми данными для демонстрации.

1.  **Наполнение БД:**
    Выполните команду ниже, чтобы сгенерировать иерархическую сеть поставщиков. Команда удалит старые данные перед созданием новых.
    ```bash
    # Для dev-окружения
    docker-compose exec web python manage.py seed_data

    # Для prod-окружения
    docker-compose -f docker-compose.yml -f docker-compose.prod.yml exec web python manage.py seed_data
    ```

2.  **Создайте суперпользователя:**
    Это необходимо для доступа к админ-панели и API.
    ```bash
    # Для dev-окружения
    docker-compose exec web python manage.py createsuperuser
    ```
    Следуйте инструкциям в терминале.

## Документация и использование API

- **Swagger UI:** [http://localhost:8000/swagger/](http://localhost:8000/swagger/) (в `dev` режиме)
- **ReDoc:** [http://localhost:8000/redoc/](http://localhost:8000/redoc/) (в `dev` режиме)

Для доступа к защищенным эндпоинтам получите токен через эндпоинт `/api/token/` и используйте его в Swagger UI, нажав на кнопку `Authorize`.

## Административная панель

Админка Django доступна по адресу: [http://localhost:8000/admin/](http://localhost:8000/admin/)
